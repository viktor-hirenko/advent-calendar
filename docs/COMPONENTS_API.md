# API компонентів

Документ описує публічний контракт основних компонентів календаря. Усі компоненти використовують Composition API та очікують, що `createAppConfig()` вже надано через `provide` (див. `src/main.ts`).

## 1. `CalendarBanner.vue`
**Призначення:** відображає графічний банер кампанії з адаптивними зображеннями та декоративними елементами.

- **Пропси:** відсутні.
- **Залежності:** читає зображення та локалізований `alt` через `useAppConfig()`.
- **Особливості:**
  - використовує `<picture>` з breakpoint’ами: mobile → tablet → desktop → large → ultra;
  - декоративний елемент підтягується через CSS-змінну `--decor-url`.
  - всі зображення проходять через `resolveImg`, що дозволяє використовувати як локальні, так і CDN-шляхи.

## 2. `CalendarContent.vue`
**Призначення:** ядро календаря. Рендерить місяці, сітку днів, панель задач і футер з кнопкою “Terms and conditions”.

- **Пропси:** немає.
- **Емітить:**
  - `day-click: CalendarDay` — користувач обрав день.
  - `terms-click` — користувач натиснув кнопку умов.
- **Композиція:**
  - `CalendarDays` — списки днів по місяцях.
  - `TaskCard` — список задач, синхронізований за індексом із днями.
- **Ключові стани:**
  - `calendarDays` (reactive) з `useAppConfig`.
  - `currentMonthIndex` — активний місяць у навігації.
  - `todayYMD` — обчислюється як `ymd(currentDate)`, оновлюється автоматично при зміні поточної дати (враховує `timeMode`).
  - `day/card caches` — `Map` для швидкого доступу до DOM-елементів та плавного скролу.
- **Поведінка:**
  - слухає `resize` + `scroll`, використовує `requestAnimationFrame` для дешевого оновлення місяця;
  - при першому маунті вибирає сьогоднішній день і синхронізує скрол панелі задач;
  - якщо змінюється `todayYMD` (через перехід через північ або `?testDate`), автоматично перескролює до нового дня та позначає його як вибраний.
- **ARIA/Accessibility:** групує дні у `<nav>` з `aria-label="Choose date"`, кнопки мають `aria-selected` та `aria-current="date"`.

## 3. `CalendarDays.vue`
**Призначення:** відображає список кнопок днів для конкретного місяця.

- **Пропси:**
  | Назва | Тип | Опис |
  |-------|-----|------|
  | `month` | `string` | Назва місяця для sr-only заголовка |
  | `days` | `CalendarDay[]` | Масив днів або плейсхолдерів |
- **Емітить:** `day-click: CalendarDay`
- **Особливості:**
  - підтримує плейсхолдери (`isPlaceholder: true`) для `alignByWeekday`;
  - кнопки мають дата-атрибути `data-day-id` та `data-date`, які використовуються для кешування у `CalendarContent`;
  - класи `--active` і `--selected` керують станами (актуальний день, обраний користувачем).

## 4. `TaskCard.vue`
**Призначення:** карточка щоденного бонусу з таймером, CTA та різними станами.

- **Пропси:**
  | Назва | Тип | Обовʼязково | Опис |
  |-------|-----|-------------|------|
  | `task` | `TaskCard` | так | Дані задачі (тексти, URL, ідентифікатор) |
  | `taskIndex` | `number` | так | Позиція задачі у масиві для розрахунку дат |
  | `language` | `SupportedLanguage` | так | Поточна мова інтерфейсу |
- **Емітить:** `button-click: TaskCard` (якщо кнопка натиснута у неактивний день; активна задача з URL виконує нативний перехід).
- **Класи стану:** `task-card--active`, `task-card--finished`, `task-card--disabled`.
- **Логіка:**
  - Статус визначається порівнянням `taskDate` із `currentDate` (з урахуванням `timeMode`).
  - Таймер запускається лише для активного дня; інтервал очищається через `watchEffect`/`onScopeDispose`.
  - Текст таймера локалізується (`taskStatus.finishesIn`, `taskStatus.dayUnit`).
  - Якщо день ще не настав → показується заглушка (`disabledTask`), кнопка веде до поточної задачі дня.
  - Опис задачі проходить через `sanitizeHtml`, тож дозволені лише whitelisted теги.
- **Доступність:** активна/завершена картка містить `aria-live="off"` для таймера (щоб не спамити скрінрідер), `role="status"` для завершених задач.

## 5. `TermsModal.vue`
**Призначення:** модальне вікно з умовами використання (Terms & Conditions), доступне та адаптивне.

- **Пропси:**
  | Назва | Тип | Обовʼязково | Опис |
  |-------|-----|-------------|------|
  | `modelValue` | `boolean` | так | Стан відкриття/закриття модалки (використовується з `v-model`) |
  | `title` | `string` | так | Заголовок модального вікна |
  | `html` | `string` | так | HTML-контент умов (проходить через `v-html`) |
  | `closeAriaLabel` | `string` | так | ARIA-мітка для кнопки закриття |

- **Емітить:** `update:modelValue: boolean` (для `v-model` синхронізації)

- **Особливості:**
  - **Teleport:** використовує `<teleport to="body">` для рендерингу поза основним DOM-деревом, уникаючи z-index проблем
  - **Transition:** плавна анімація появи/зникнення через Vue `<transition name="modal">`
    - Фон: fade in/out (opacity)
    - Діалог: scale + fade (від 0.8 до 1.0)
    - Тривалість: 0.3s з easing
  - **Scroll lock:** автоматично блокує скрол `<body>` при відкритті модалки
  - **Focus trap:** утримує фокус всередині діалогу, циклічна навігація Tab
  - **Keyboard:** закриття на ESC, підтримка Tab/Shift+Tab для навігації
  - **Click outside:** закриття при кліку на backdrop (через `@click.self`)
  - **Accessibility:**
    - `role="dialog"` та `aria-modal="true"`
    - `aria-labelledby` та `aria-describedby` для зв'язку з контентом
    - Автоматичне відновлення фокусу після закриття
    - `tabindex="-1"` на діалозі для програмного фокусування

- **Інтеграція:**
  ```vue
  <TermsModal
    v-if="config.ui.footerSection.termsModal.visible"
    v-model="showTerms"
    :title="termsTitle"
    :html="termsHtml"
    :close-aria-label="closeAria"
  />
  ```

- **Контент:**
  - Заголовок та HTML-контент беруться з `calendar.termsModal` в `app-config.json`
  - Контент локалізований через `getLocalizedText`
  - **ВАЖЛИВО:** HTML-контент вважається довіреним (з конфігу). Якщо джерело стане зовнішнім, додайте санітизацію через `DOMPurify`

- **Стилізація:**
  - Backdrop: напівпрозорий чорний фон (`rgba(0, 0, 0, 0.6)`)
  - Діалог: центрований, 90% ширини з відступами 5% з боків
  - Адаптивність: на мобільних займає більше місця, на десктопі обмежений розмірами
  - Кнопка закриття: позиціонована абсолютно в правому верхньому куті

## 6. `App.vue`
Хай-левел композиція: рендерить `CalendarBanner`, `CalendarContent`, передає події у `devLog`. Тут можна інтегрувати аналітику або кастомну навігацію, реагуючи на `day-click` та `terms-click`.

---

### Додаткові компоненти/утиліти
- **`useMediaQuery('(min-width: 768px)')`** в `CalendarContent` керує адаптивною логікою (напр., вирівнювання по тижнях лише на десктопі).
- **`isWeekAlignMode`** — computed значення, яке визначає, чи потрібно вирівнювання по тижнях на поточному екрані.

Всі компоненти стилізуються через SCSS із доступом до токенів та утилітних міксинів, що дозволяє швидко змінювати тему або адаптивні правила без втручання в логіку.
